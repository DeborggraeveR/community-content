---
path: "/tutorials/install-kubernetes-ha-cluster"
slug: "tutorial-template"
date: "2019-09-25"
title: "Install kubernetes HA cluster"
short_description: "How to install a high available kubernetes cluster on Hetzner Cloud."
tags: ["Hetzner Cloud", "Kubernetes", "HA"]
author: "Deborggraeve Randy"
author_link: "https://github.com/DeborggraeveR"
author_img: "https://avatars2.githubusercontent.com/u/11926967"
author_description: ""
language: "en"
available_languages: ["en"]
header_img: ""
---

## Introduction

In this tutorial we will create a high availability kubernetes cluster with 3 master nodes, 2 worker nodes and a HA-Proxy server.
All servers are running Ubuntu 18.04 and are added to a private network (10.0.0.0/24)
It is adviced to create a non root user on each server with root priveleges.

**Prerequisites**

6 or more Hetzner cloud servers.
k8s-gateway:
* Type: CX11
* IPv4: 10.0.0.200

k8s-master-001:
* Type: CX21
* IPv4: 10.0.0.2

k8s-master-002:
* Type: CX21
* IPv4: 10.0.0.3

k8s-master-003:
* Type: CX21
* IPv4: 10.0.0.4

k8s-worker-001:
* Type: CX21
* IPv4: 10.0.0.5

k8s-worker-002:
* Type: CX21
* IPv4: 10.0.0.6

## Step 1 - Setup the HA-Proxy

The HA-Proxy server is responsible for the load balancing of the master servers, to make sure at least one of the master server is reachable by the cluster.

**Install HA-Proxy**
`apt-get install haproxy`

**Update the ha-proxy config file**
`nano /etc/haproxy/haproxy.cfg`
```
defaults
        ...
        option forwardfor
        option http-server-close
        ...

frontend http_stats
        bind *:8080
        mode http
        stats uri /haproxy?stats

frontend kubernetes-api
        bind *:6443
        mode tcp
        option tcplog
        timeout client 10800s
        default_backend kubernetes-api

backend kubernetes-api
        mode tcp
        option tcplog
        option tcp-check
        balance leastconn
        timeout server 10800s
        server k8s-master-001 10.0.0.2:6443 check fall 3 rise 2
        server k8s-master-002 10.0.0.3:6443 check fall 3 rise 2
        server k8s-master-003 10.0.0.4:6443 check fall 3 rise 2
```
**Restart HA-Proxy**
`systemctl restart haproxy`

## Step 2 - <summary of step>

More instructions.

### Step 2.1 - <summary of step>

Here is a code example

```javascript
var s = "JavaScript syntax highlighting";
alert(s);
```

### Step 2.2 - <summary of step>

Another code example

```python
s = "Python syntax highlighting"
print s
```

## Step 3 - <summary of step> (Optional)

Yet more instructions.

### Terminology
* Username: `holu` (short for Hetzner OnLine User)
* Hostname: `<your_host>`
* Domain: `<example.com>`

Server:
* IPv4: `<10.0.0.1>`
* IPv6: `<2001:db8:1234::1>`

Gateway:
* IPv4: `<192.0.2.254>`
* IPv6: `<2001:db8:1234::ffff>`

Client private:
* IPv4: `<198.51.100.1>`
* IPv6 `<2001:db8:9abc::1>`

Client public:
* IPv4: `<203.0.113.1>`
* IPv6: `<2001:db8:5678::1>`

## Step N - <summary of step>

More instructions.

## Conclusion

A short conclusion summarizing what the user has done, and maybe suggesting different courses of action they can now take.

##### License: MIT

<!--

Contributor's Certificate of Origin

By making a contribution to this project, I certify that:

(a) The contribution was created in whole or in part by me and I have
    the right to submit it under the license indicated in the file; or

(b) The contribution is based upon previous work that, to the best of my
    knowledge, is covered under an appropriate license and I have the
    right under that license to submit that work with modifications,
    whether created in whole or in part by me, under the same license
    (unless I am permitted to submit under a different license), as
    indicated in the file; or

(c) The contribution was provided directly to me by some other person
    who certified (a), (b) or (c) and I have not modified it.

(d) I understand and agree that this project and the contribution are
    public and that a record of the contribution (including all personal
    information I submit with it, including my sign-off) is maintained
    indefinitely and may be redistributed consistent with this project
    or the license(s) involved.

Signed-off-by: [submitter's name and email address here]

-->
